AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Resources:
  FastAPIProxyApi:
    Type: AWS::Serverless::Api
    Properties:
      StageName: dev
      MinimumCompressionSize: 1024
  FastAPILambdaFunction:
    Type: AWS::Serverless::Function
    Properties:
      PackageType: Image
      Architectures:
      - x86_64
      Timeout: 10
      MemorySize: 128
      EphemeralStorage:
        Size: 512
      ReservedConcurrentExecutions: 10
      Policies: AWSLambdaBasicExecutionRole
      Events:
        FastAPIProxy:
          Type: Api
          Properties:
            Path: /{proxy+}
            Method: ANY
            RestApiId:
              Ref: FastAPIProxyApi
      ImageUri: fastapilambdafunction:fastapi-lambda
    Metadata:
      DockerContext: C:\Users\thiag\Documents\portfolio\machine-learning-aws-api\lambda
      DockerTag: fastapi-lambda
      Dockerfile: Dockerfile
      SamResourceId: FastAPILambdaFunction
Outputs:
  LambdaFunctionArn:
    Description: ARN of the deployed Lambda function
    Value:
      Fn::GetAtt:
      - FastAPILambdaFunction
      - Arn
  ApiEndpoint:
    Description: The URL of the API Gateway endpoint
    Value:
      Fn::Sub: https://${FastAPIProxyApi}.execute-api.${AWS::Region}.amazonaws.com/
